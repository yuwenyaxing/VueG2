{"version":3,"sources":["../../src/layer/baseLayer.ts"],"names":["LineLayer","PointLayer","PolygonLayer","Popup","EventEmitter","geobuf","isObject","mergeWith","Pbf","simplify","setDataLevel","mergeCustomizer","objValue","srcValue","Array","isArray","BaseLayer","scene","option","fillLayer","lineLayer","labelLayer","bubbleLayer","options","layers","fillData","popup","getDefaultOption","geoDataLevel","forEach","layer","removeLayer","length","show","hide","newOption","newData","joinByField","setOption","data","joinBy","setData","transforms","type","sourceField","targetField","fetch","url","arrayBuffer","buffer","geojson","decode","simplifyTolerance","json","zIndex","visible","depth","adcode","label","enable","color","field","size","stroke","strokeWidth","textAllowOverlap","opacity","textOffset","padding","bubble","shape","style","fill","scale","activeColor","autoFit","showBorder","strokeVisible","cityStroke","cityStrokeWidth","countyStrokeWidth","provinceStrokeWidth","provinceStroke","provinceStrokeVisible","countyStroke","coastlineStroke","coastlineWidth","nationalStroke","nationalWidth","chinaNationalStroke","chinaNationalWidth","openTriggerEvent","closeTriggerEvent","Html","properties","name","fillCountry","source","setLayerAttribute","filter","active","push","addLayer","labeldata","features","map","feature","center","x","y","addBubbleLayer","addPopup","emit","provinceLine","layer2","labelData","addLabel","parser","coordinates","popupLayer","triggerLayer","on","e","html","closeButton","setLnglat","lngLat","setHTML","remove","attr","values"],"mappings":"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","sourcesContent":["import {\n  ILayer,\n  IPopup,\n  LineLayer,\n  PointLayer,\n  PolygonLayer,\n  Popup,\n  Scene,\n  StyleAttrField,\n} from '@antv/l7';\nimport { EventEmitter } from 'eventemitter3';\n// @ts-ignore\nimport geobuf from 'geobuf';\n// tslint:disable-next-line: no-submodule-imports\nimport isObject from 'lodash/isObject';\n// tslint:disable-next-line: no-submodule-imports\nimport mergeWith from 'lodash/mergeWith';\n// @ts-ignore\nimport Pbf from 'pbf';\n// @ts-ignore\nimport simplify from 'simplify-geojson';\nimport { setDataLevel } from '../config';\nimport { AttributeType, IDistrictLayerOption } from './interface';\n\nfunction mergeCustomizer(objValue: any, srcValue: any) {\n  if (Array.isArray(srcValue)) {\n    return srcValue;\n  }\n}\nexport default class BaseLayer extends EventEmitter {\n  public fillLayer: ILayer;\n  public lineLayer: ILayer;\n  public labelLayer: ILayer;\n  public bubbleLayer: ILayer;\n  protected scene: Scene;\n  protected options: IDistrictLayerOption;\n  protected layers: ILayer[] = [];\n  protected fillData: any;\n  private popup: IPopup;\n\n  constructor(scene: Scene, option: Partial<IDistrictLayerOption> = {}) {\n    super();\n    this.scene = scene;\n    this.options = mergeWith(this.getDefaultOption(), option, mergeCustomizer);\n    setDataLevel(this.options.geoDataLevel);\n  }\n\n  public destroy() {\n    this.layers.forEach((layer) => this.scene.removeLayer(layer));\n    this.layers.length = 0;\n  }\n\n  public show() {\n    this.layers.forEach((layer) => layer.show());\n  }\n  public hide() {\n    this.layers.forEach((layer) => layer.hide());\n  }\n\n  public setOption(newOption: { [key: string]: any }) {\n    this.options = mergeWith(this.options, newOption, mergeCustomizer);\n  }\n\n  public getFillData() {\n    return this.fillData;\n  }\n\n  public updateData(\n    newData?: Array<{ [key: string]: any }>,\n    joinByField?: [string, string],\n  ) {\n    this.setOption({\n      data: newData,\n      joinBy: joinByField,\n    });\n    const { data = [], joinBy } = this.options;\n    this.fillLayer.setData(this.fillData, {\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n  }\n  protected async fetchData(data: { url: any; type: string }) {\n    if (data.type === 'pbf') {\n      const buffer = await (await fetch(data.url)).arrayBuffer();\n      let geojson = geobuf.decode(new Pbf(buffer));\n      if (this.options.simplifyTolerance !== false) {\n        geojson = simplify(geojson, this.options.simplifyTolerance);\n      }\n      return geojson;\n    } else {\n      return isObject(data.url) ? data.url : (await fetch(data.url)).json();\n    }\n  }\n  protected getDefaultOption(): IDistrictLayerOption {\n    return {\n      zIndex: 0,\n      visible: true,\n      geoDataLevel: 2,\n      depth: 1,\n      adcode: [],\n      joinBy: ['name', 'name'],\n      simplifyTolerance: false,\n      label: {\n        enable: true,\n        color: '#000',\n        field: 'name',\n        size: 10,\n        stroke: '#fff',\n        strokeWidth: 2,\n        textAllowOverlap: true,\n        opacity: 1,\n        textOffset: [0, 0],\n        padding: [5, 5],\n      },\n      bubble: {\n        enable: false,\n        shape: 'circle',\n        color: '#1AA9FF',\n        size: 15,\n        style: {\n          opacity: 1,\n          stroke: '#fff',\n          strokeWidth: 1,\n        },\n      },\n      fill: {\n        scale: null,\n        color: '#ddd',\n        style: {\n          opacity: 1.0,\n        },\n        activeColor: false,\n      },\n      autoFit: true,\n      showBorder: true,\n      stroke: '#bdbdbd',\n      strokeVisible: true,\n      strokeWidth: 0.6,\n      cityStroke: '#636363',\n      cityStrokeWidth: 0.6,\n      countyStrokeWidth: 0.6,\n      provinceStrokeWidth: 0.6,\n      provinceStroke: '#f0f0f0',\n      provinceStrokeVisible: true,\n      countyStroke: '#525252',\n      coastlineStroke: '#4190da',\n      coastlineWidth: 0.6,\n      nationalStroke: '#c994c7',\n      nationalWidth: 0.5,\n      chinaNationalStroke: 'gray',\n      chinaNationalWidth: 1,\n      popup: {\n        enable: true,\n        openTriggerEvent: 'mousemove',\n        closeTriggerEvent: 'mouseout',\n        option: {},\n        Html: (properties: any) => {\n          return `${properties.name}`;\n        },\n      },\n    };\n  }\n\n  protected addFillLayer(fillCountry: any) {\n    // 添加省份填充\n    const { popup, data = [], fill, autoFit, joinBy, visible } = this.options;\n    this.fillData = fillCountry;\n    const fillLayer = new PolygonLayer({\n      autoFit,\n      visible,\n    }).source(fillCountry, {\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n    this.setLayerAttribute(fillLayer, 'color', fill.color as AttributeType);\n    this.setLayerAttribute(fillLayer, 'filter', fill.filter as AttributeType);\n    if (fill.scale && isObject(fill.color)) {\n      fillLayer.scale('color', {\n        type: fill.scale,\n        field: fill.color.field as string,\n      });\n    }\n    fillLayer.shape('fill').style(fill.style);\n\n    if (fill.activeColor) {\n      fillLayer.active({\n        color: fill.activeColor as string,\n      });\n    }\n    this.fillLayer = fillLayer;\n    this.layers.push(fillLayer);\n    this.scene.addLayer(fillLayer);\n    if (this.options.bubble && this.options.bubble?.enable !== false) {\n      const labeldata = fillCountry.features.map((feature: any) => {\n        return {\n          ...feature.properties,\n          center: [feature.properties.x, feature.properties.y],\n        };\n      });\n      this.addBubbleLayer(labeldata);\n    }\n    if (popup.enable) {\n      this.addPopup();\n    }\n\n    this.emit('loaded');\n  }\n\n  protected addFillLine(provinceLine: any) {\n    const { stroke, strokeWidth, zIndex, visible } = this.options;\n    const layer2 = new LineLayer({\n      zIndex: zIndex + 0.1,\n      visible,\n    })\n      .source(provinceLine)\n      .color(stroke)\n      .size(strokeWidth)\n      .style({\n        opacity: 1,\n      });\n    this.scene.addLayer(layer2);\n    this.layers.push(layer2);\n    this.lineLayer = layer2;\n  }\n\n  protected addLabelLayer(labelData: any, type: string = 'json') {\n    const labelLayer = this.addLabel(labelData, type);\n    this.scene.addLayer(labelLayer);\n    this.layers.push(labelLayer);\n    this.labelLayer = labelLayer;\n  }\n\n  protected addBubbleLayer(labelData: any, type: string = 'json') {\n    const { bubble, zIndex, data = [], joinBy, visible } = this.options;\n    const bubbleLayer = new PointLayer({\n      zIndex: zIndex + 0.3,\n      visible,\n    }).source(labelData, {\n      parser: {\n        type,\n        coordinates: 'center',\n      },\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n    this.setLayerAttribute(bubbleLayer, 'color', bubble.color as AttributeType);\n    this.setLayerAttribute(bubbleLayer, 'size', bubble.size as AttributeType);\n    this.setLayerAttribute(bubbleLayer, 'shape', bubble.shape as AttributeType);\n    this.setLayerAttribute(\n      bubbleLayer,\n      'filter',\n      bubble.filter as AttributeType,\n    );\n    if (bubble.scale) {\n      bubbleLayer.scale(bubble.scale.field, {\n        type: bubble.scale.type,\n      });\n    }\n    bubbleLayer.style(bubble.style);\n    this.scene.addLayer(bubbleLayer);\n    this.layers.push(bubbleLayer);\n    this.bubbleLayer = bubbleLayer;\n    return bubbleLayer;\n  }\n\n  protected addLabel(labelData: any, type: string = 'json') {\n    const { label, zIndex, visible } = this.options;\n    const labelLayer = new PointLayer({\n      zIndex: zIndex + 5,\n      visible,\n    })\n      .source(labelData, {\n        parser: {\n          type,\n          coordinates: 'center',\n        },\n      })\n      .shape(label.field as StyleAttrField, 'text')\n      .style(label);\n    this.setLayerAttribute(labelLayer, 'color', label.color as AttributeType);\n    this.setLayerAttribute(labelLayer, 'size', label.size as AttributeType);\n    this.setLayerAttribute(labelLayer, 'filter', label.filter);\n    return labelLayer;\n  }\n\n  protected addPopup() {\n    const { popup } = this.options;\n    let popupLayer;\n    if (popup.triggerLayer) {\n      popupLayer =\n        popup.triggerLayer === 'bubble' ? this.bubbleLayer : this.fillLayer;\n    } else {\n      popupLayer = this.options.bubble.enable\n        ? this.bubbleLayer\n        : this.fillLayer;\n    }\n    popupLayer.on(popup.openTriggerEvent as string, (e) => {\n      const html = popup.Html\n        ? popup.Html(e.feature.properties ? e.feature.properties : e.feature)\n        : '';\n      this.popup = new Popup({\n        closeButton: false,\n        ...popup.option,\n      })\n        .setLnglat(e.lngLat)\n        .setHTML(html);\n      this.scene.addPopup(this.popup);\n    });\n\n    popupLayer.on(popup.closeTriggerEvent as string, (e) => {\n      if (this.popup) {\n        this.popup.remove();\n      }\n    });\n  }\n\n  private setLayerAttribute(\n    layer: ILayer,\n    type: 'color' | 'size' | 'shape' | 'filter',\n    attr: AttributeType | undefined,\n  ) {\n    if (!attr) {\n      return;\n    }\n    if (isObject(attr)) {\n      // @ts-ignore\n      layer[type](attr.field, attr.values);\n    } else {\n      // @ts-ignore\n      layer[type](attr);\n    }\n  }\n}\n"],"file":"baseLayer.js"}