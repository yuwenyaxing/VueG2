{"version":3,"sources":["../../src/layer/baseLayer.ts"],"names":["mergeCustomizer","objValue","srcValue","Array","isArray","BaseLayer","scene","option","fillLayer","lineLayer","labelLayer","bubbleLayer","options","layers","fillData","popup","getDefaultOption","geoDataLevel","forEach","layer","removeLayer","length","show","hide","newOption","newData","joinByField","setOption","data","joinBy","setData","transforms","type","sourceField","targetField","fetch","url","arrayBuffer","buffer","geojson","geobuf","decode","Pbf","simplifyTolerance","json","zIndex","visible","depth","adcode","label","enable","color","field","size","stroke","strokeWidth","textAllowOverlap","opacity","textOffset","padding","bubble","shape","style","fill","scale","activeColor","autoFit","showBorder","strokeVisible","cityStroke","cityStrokeWidth","countyStrokeWidth","provinceStrokeWidth","provinceStroke","provinceStrokeVisible","countyStroke","coastlineStroke","coastlineWidth","nationalStroke","nationalWidth","chinaNationalStroke","chinaNationalWidth","openTriggerEvent","closeTriggerEvent","Html","properties","name","fillCountry","PolygonLayer","source","setLayerAttribute","filter","active","push","addLayer","labeldata","features","map","feature","center","x","y","addBubbleLayer","addPopup","emit","provinceLine","layer2","LineLayer","labelData","addLabel","PointLayer","parser","coordinates","popupLayer","triggerLayer","on","e","html","Popup","closeButton","setLnglat","lngLat","setHTML","remove","attr","values","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAUA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AACA;;;;;;;;;;AAGA,SAASA,eAAT,CAAyBC,QAAzB,EAAwCC,QAAxC,EAAuD;AACrD,MAAIC,KAAK,CAACC,OAAN,CAAcF,QAAd,CAAJ,EAA6B;AAC3B,WAAOA,QAAP;AACD;AACF;;IACoBG,S;;;;;AAWnB,qBAAYC,KAAZ,EAAsE;AAAA;;AAAA,QAA5CC,MAA4C,uEAAJ,EAAI;AAAA;AACpE;AADoE,UAV/DC,SAU+D;AAAA,UAT/DC,SAS+D;AAAA,UAR/DC,UAQ+D;AAAA,UAP/DC,WAO+D;AAAA,UAN5DL,KAM4D;AAAA,UAL5DM,OAK4D;AAAA,UAJ5DC,MAI4D,GAJzC,EAIyC;AAAA,UAH5DC,QAG4D;AAAA,UAF9DC,KAE8D;AAEpE,UAAKT,KAAL,GAAaA,KAAb;AACA,UAAKM,OAAL,GAAe,wBAAU,MAAKI,gBAAL,EAAV,EAAmCT,MAAnC,EAA2CP,eAA3C,CAAf;AACA,8BAAa,MAAKY,OAAL,CAAaK,YAA1B;AAJoE;AAKrE;;;;8BAEgB;AAAA;;AACf,WAAKJ,MAAL,CAAYK,OAAZ,CAAoB,UAACC,KAAD;AAAA,eAAW,MAAI,CAACb,KAAL,CAAWc,WAAX,CAAuBD,KAAvB,CAAX;AAAA,OAApB;AACA,WAAKN,MAAL,CAAYQ,MAAZ,GAAqB,CAArB;AACD;;;2BAEa;AACZ,WAAKR,MAAL,CAAYK,OAAZ,CAAoB,UAACC,KAAD;AAAA,eAAWA,KAAK,CAACG,IAAN,EAAX;AAAA,OAApB;AACD;;;2BACa;AACZ,WAAKT,MAAL,CAAYK,OAAZ,CAAoB,UAACC,KAAD;AAAA,eAAWA,KAAK,CAACI,IAAN,EAAX;AAAA,OAApB;AACD;;;8BAEgBC,S,EAAmC;AAClD,WAAKZ,OAAL,GAAe,wBAAU,KAAKA,OAAf,EAAwBY,SAAxB,EAAmCxB,eAAnC,CAAf;AACD;;;kCAEoB;AACnB,aAAO,KAAKc,QAAZ;AACD;;;+BAGCW,O,EACAC,W,EACA;AACA,WAAKC,SAAL,CAAe;AACbC,QAAAA,IAAI,EAAEH,OADO;AAEbI,QAAAA,MAAM,EAAEH;AAFK,OAAf;AADA,0BAK8B,KAAKd,OALnC;AAAA,6CAKQgB,IALR;AAAA,UAKQA,IALR,mCAKe,EALf;AAAA,UAKmBC,MALnB,iBAKmBA,MALnB;AAMA,WAAKrB,SAAL,CAAesB,OAAf,CAAuB,KAAKhB,QAA5B,EAAsC;AACpCiB,QAAAA,UAAU,EACRH,IAAI,CAACP,MAAL,KAAgB,CAAhB,GACI,EADJ,GAEI,CACE;AACEW,UAAAA,IAAI,EAAE,MADR;AAEEC,UAAAA,WAAW,EAAEJ,MAAM,CAAC,CAAD,CAFrB;AAGEK,UAAAA,WAAW,EAAEL,MAAM,CAAC,CAAD,CAHrB;AAIED,UAAAA,IAAI,EAAJA;AAJF,SADF;AAJ8B,OAAtC;AAaD;;;;kGACyBA,I;;;;;;sBACpBA,IAAI,CAACI,IAAL,KAAc,K;;;;;;uBACYG,KAAK,CAACP,IAAI,CAACQ,GAAN,C;;;;qCAAYC,W;;;AAAvCC,gBAAAA,M;AACFC,gBAAAA,O,GAAUC,gBAAOC,MAAP,CAAc,IAAIC,YAAJ,CAAQJ,MAAR,CAAd,C;;AACd,oBAAI,KAAK1B,OAAL,CAAa+B,iBAAb,KAAmC,KAAvC,EAA8C;AAC5CJ,kBAAAA,OAAO,GAAG,8BAASA,OAAT,EAAkB,KAAK3B,OAAL,CAAa+B,iBAA/B,CAAV;AACD;;iDACMJ,O;;;qBAEA,uBAASX,IAAI,CAACQ,GAAd,C;;;;;8BAAqBR,IAAI,CAACQ,G;;;;;;uBAAaD,KAAK,CAACP,IAAI,CAACQ,GAAN,C;;;4CAAYQ,I;;;;;;;;;;;;;;;;;;;;;uCAGhB;AACjD,aAAO;AACLC,QAAAA,MAAM,EAAE,CADH;AAELC,QAAAA,OAAO,EAAE,IAFJ;AAGL7B,QAAAA,YAAY,EAAE,CAHT;AAIL8B,QAAAA,KAAK,EAAE,CAJF;AAKLC,QAAAA,MAAM,EAAE,EALH;AAMLnB,QAAAA,MAAM,EAAE,CAAC,MAAD,EAAS,MAAT,CANH;AAOLc,QAAAA,iBAAiB,EAAE,KAPd;AAQLM,QAAAA,KAAK,EAAE;AACLC,UAAAA,MAAM,EAAE,IADH;AAELC,UAAAA,KAAK,EAAE,MAFF;AAGLC,UAAAA,KAAK,EAAE,MAHF;AAILC,UAAAA,IAAI,EAAE,EAJD;AAKLC,UAAAA,MAAM,EAAE,MALH;AAMLC,UAAAA,WAAW,EAAE,CANR;AAOLC,UAAAA,gBAAgB,EAAE,IAPb;AAQLC,UAAAA,OAAO,EAAE,CARJ;AASLC,UAAAA,UAAU,EAAE,CAAC,CAAD,EAAI,CAAJ,CATP;AAULC,UAAAA,OAAO,EAAE,CAAC,CAAD,EAAI,CAAJ;AAVJ,SARF;AAoBLC,QAAAA,MAAM,EAAE;AACNV,UAAAA,MAAM,EAAE,KADF;AAENW,UAAAA,KAAK,EAAE,QAFD;AAGNV,UAAAA,KAAK,EAAE,SAHD;AAINE,UAAAA,IAAI,EAAE,EAJA;AAKNS,UAAAA,KAAK,EAAE;AACLL,YAAAA,OAAO,EAAE,CADJ;AAELH,YAAAA,MAAM,EAAE,MAFH;AAGLC,YAAAA,WAAW,EAAE;AAHR;AALD,SApBH;AA+BLQ,QAAAA,IAAI,EAAE;AACJC,UAAAA,KAAK,EAAE,IADH;AAEJb,UAAAA,KAAK,EAAE,MAFH;AAGJW,UAAAA,KAAK,EAAE;AACLL,YAAAA,OAAO,EAAE;AADJ,WAHH;AAMJQ,UAAAA,WAAW,EAAE;AANT,SA/BD;AAuCLC,QAAAA,OAAO,EAAE,IAvCJ;AAwCLC,QAAAA,UAAU,EAAE,IAxCP;AAyCLb,QAAAA,MAAM,EAAE,SAzCH;AA0CLc,QAAAA,aAAa,EAAE,IA1CV;AA2CLb,QAAAA,WAAW,EAAE,GA3CR;AA4CLc,QAAAA,UAAU,EAAE,SA5CP;AA6CLC,QAAAA,eAAe,EAAE,GA7CZ;AA8CLC,QAAAA,iBAAiB,EAAE,GA9Cd;AA+CLC,QAAAA,mBAAmB,EAAE,GA/ChB;AAgDLC,QAAAA,cAAc,EAAE,SAhDX;AAiDLC,QAAAA,qBAAqB,EAAE,IAjDlB;AAkDLC,QAAAA,YAAY,EAAE,SAlDT;AAmDLC,QAAAA,eAAe,EAAE,SAnDZ;AAoDLC,QAAAA,cAAc,EAAE,GApDX;AAqDLC,QAAAA,cAAc,EAAE,SArDX;AAsDLC,QAAAA,aAAa,EAAE,GAtDV;AAuDLC,QAAAA,mBAAmB,EAAE,MAvDhB;AAwDLC,QAAAA,kBAAkB,EAAE,CAxDf;AAyDLlE,QAAAA,KAAK,EAAE;AACLmC,UAAAA,MAAM,EAAE,IADH;AAELgC,UAAAA,gBAAgB,EAAE,WAFb;AAGLC,UAAAA,iBAAiB,EAAE,UAHd;AAIL5E,UAAAA,MAAM,EAAE,EAJH;AAKL6E,UAAAA,IAAI,EAAE,cAACC,UAAD,EAAqB;AACzB,6BAAUA,UAAU,CAACC,IAArB;AACD;AAPI;AAzDF,OAAP;AAmED;;;iCAEsBC,W,EAAkB;AAAA;;AAAA,2BAEsB,KAAK3E,OAF3B;AAAA,UAE/BG,KAF+B,kBAE/BA,KAF+B;AAAA,+CAExBa,IAFwB;AAAA,UAExBA,IAFwB,oCAEjB,EAFiB;AAAA,UAEbmC,IAFa,kBAEbA,IAFa;AAAA,UAEPG,OAFO,kBAEPA,OAFO;AAAA,UAEErC,MAFF,kBAEEA,MAFF;AAAA,UAEUiB,OAFV,kBAEUA,OAFV;AAGvC,WAAKhC,QAAL,GAAgByE,WAAhB;AACA,UAAM/E,SAAS,GAAG,IAAIgF,eAAJ,CAAiB;AACjCtB,QAAAA,OAAO,EAAPA,OADiC;AAEjCpB,QAAAA,OAAO,EAAPA;AAFiC,OAAjB,EAGf2C,MAHe,CAGRF,WAHQ,EAGK;AACrBxD,QAAAA,UAAU,EACRH,IAAI,CAACP,MAAL,KAAgB,CAAhB,GACI,EADJ,GAEI,CACE;AACEW,UAAAA,IAAI,EAAE,MADR;AAEEC,UAAAA,WAAW,EAAEJ,MAAM,CAAC,CAAD,CAFrB;AAGEK,UAAAA,WAAW,EAAEL,MAAM,CAAC,CAAD,CAHrB;AAIED,UAAAA,IAAI,EAAJA;AAJF,SADF;AAJe,OAHL,CAAlB;AAgBA,WAAK8D,iBAAL,CAAuBlF,SAAvB,EAAkC,OAAlC,EAA2CuD,IAAI,CAACZ,KAAhD;AACA,WAAKuC,iBAAL,CAAuBlF,SAAvB,EAAkC,QAAlC,EAA4CuD,IAAI,CAAC4B,MAAjD;;AACA,UAAI5B,IAAI,CAACC,KAAL,IAAc,uBAASD,IAAI,CAACZ,KAAd,CAAlB,EAAwC;AACtC3C,QAAAA,SAAS,CAACwD,KAAV,CAAgB,OAAhB,EAAyB;AACvBhC,UAAAA,IAAI,EAAE+B,IAAI,CAACC,KADY;AAEvBZ,UAAAA,KAAK,EAAEW,IAAI,CAACZ,KAAL,CAAWC;AAFK,SAAzB;AAID;;AACD5C,MAAAA,SAAS,CAACqD,KAAV,CAAgB,MAAhB,EAAwBC,KAAxB,CAA8BC,IAAI,CAACD,KAAnC;;AAEA,UAAIC,IAAI,CAACE,WAAT,EAAsB;AACpBzD,QAAAA,SAAS,CAACoF,MAAV,CAAiB;AACfzC,UAAAA,KAAK,EAAEY,IAAI,CAACE;AADG,SAAjB;AAGD;;AACD,WAAKzD,SAAL,GAAiBA,SAAjB;AACA,WAAKK,MAAL,CAAYgF,IAAZ,CAAiBrF,SAAjB;AACA,WAAKF,KAAL,CAAWwF,QAAX,CAAoBtF,SAApB;;AACA,UAAI,KAAKI,OAAL,CAAagD,MAAb,IAAuB,8BAAKhD,OAAL,CAAagD,MAAb,8EAAqBV,MAArB,MAAgC,KAA3D,EAAkE;AAChE,YAAM6C,SAAS,GAAGR,WAAW,CAACS,QAAZ,CAAqBC,GAArB,CAAyB,UAACC,OAAD,EAAkB;AAC3D,iDACKA,OAAO,CAACb,UADb;AAEEc,YAAAA,MAAM,EAAE,CAACD,OAAO,CAACb,UAAR,CAAmBe,CAApB,EAAuBF,OAAO,CAACb,UAAR,CAAmBgB,CAA1C;AAFV;AAID,SALiB,CAAlB;AAMA,aAAKC,cAAL,CAAoBP,SAApB;AACD;;AACD,UAAIhF,KAAK,CAACmC,MAAV,EAAkB;AAChB,aAAKqD,QAAL;AACD;;AAED,WAAKC,IAAL,CAAU,QAAV;AACD;;;gCAEqBC,Y,EAAmB;AAAA,2BACU,KAAK7F,OADf;AAAA,UAC/B0C,MAD+B,kBAC/BA,MAD+B;AAAA,UACvBC,WADuB,kBACvBA,WADuB;AAAA,UACVV,MADU,kBACVA,MADU;AAAA,UACFC,OADE,kBACFA,OADE;AAEvC,UAAM4D,MAAM,GAAG,IAAIC,YAAJ,CAAc;AAC3B9D,QAAAA,MAAM,EAAEA,MAAM,GAAG,GADU;AAE3BC,QAAAA,OAAO,EAAPA;AAF2B,OAAd,EAIZ2C,MAJY,CAILgB,YAJK,EAKZtD,KALY,CAKNG,MALM,EAMZD,IANY,CAMPE,WANO,EAOZO,KAPY,CAON;AACLL,QAAAA,OAAO,EAAE;AADJ,OAPM,CAAf;AAUA,WAAKnD,KAAL,CAAWwF,QAAX,CAAoBY,MAApB;AACA,WAAK7F,MAAL,CAAYgF,IAAZ,CAAiBa,MAAjB;AACA,WAAKjG,SAAL,GAAiBiG,MAAjB;AACD;;;kCAEuBE,S,EAAuC;AAAA,UAAvB5E,IAAuB,uEAAR,MAAQ;AAC7D,UAAMtB,UAAU,GAAG,KAAKmG,QAAL,CAAcD,SAAd,EAAyB5E,IAAzB,CAAnB;AACA,WAAK1B,KAAL,CAAWwF,QAAX,CAAoBpF,UAApB;AACA,WAAKG,MAAL,CAAYgF,IAAZ,CAAiBnF,UAAjB;AACA,WAAKA,UAAL,GAAkBA,UAAlB;AACD;;;mCAEwBkG,S,EAAuC;AAAA,UAAvB5E,IAAuB,uEAAR,MAAQ;AAAA,2BACP,KAAKpB,OADE;AAAA,UACtDgD,MADsD,kBACtDA,MADsD;AAAA,UAC9Cf,MAD8C,kBAC9CA,MAD8C;AAAA,+CACtCjB,IADsC;AAAA,UACtCA,IADsC,oCAC/B,EAD+B;AAAA,UAC3BC,MAD2B,kBAC3BA,MAD2B;AAAA,UACnBiB,OADmB,kBACnBA,OADmB;AAE9D,UAAMnC,WAAW,GAAG,IAAImG,aAAJ,CAAe;AACjCjE,QAAAA,MAAM,EAAEA,MAAM,GAAG,GADgB;AAEjCC,QAAAA,OAAO,EAAPA;AAFiC,OAAf,EAGjB2C,MAHiB,CAGVmB,SAHU,EAGC;AACnBG,QAAAA,MAAM,EAAE;AACN/E,UAAAA,IAAI,EAAJA,IADM;AAENgF,UAAAA,WAAW,EAAE;AAFP,SADW;AAKnBjF,QAAAA,UAAU,EACRH,IAAI,CAACP,MAAL,KAAgB,CAAhB,GACI,EADJ,GAEI,CACE;AACEW,UAAAA,IAAI,EAAE,MADR;AAEEC,UAAAA,WAAW,EAAEJ,MAAM,CAAC,CAAD,CAFrB;AAGEK,UAAAA,WAAW,EAAEL,MAAM,CAAC,CAAD,CAHrB;AAIED,UAAAA,IAAI,EAAJA;AAJF,SADF;AARa,OAHD,CAApB;AAoBA,WAAK8D,iBAAL,CAAuB/E,WAAvB,EAAoC,OAApC,EAA6CiD,MAAM,CAACT,KAApD;AACA,WAAKuC,iBAAL,CAAuB/E,WAAvB,EAAoC,MAApC,EAA4CiD,MAAM,CAACP,IAAnD;AACA,WAAKqC,iBAAL,CAAuB/E,WAAvB,EAAoC,OAApC,EAA6CiD,MAAM,CAACC,KAApD;AACA,WAAK6B,iBAAL,CACE/E,WADF,EAEE,QAFF,EAGEiD,MAAM,CAAC+B,MAHT;;AAKA,UAAI/B,MAAM,CAACI,KAAX,EAAkB;AAChBrD,QAAAA,WAAW,CAACqD,KAAZ,CAAkBJ,MAAM,CAACI,KAAP,CAAaZ,KAA/B,EAAsC;AACpCpB,UAAAA,IAAI,EAAE4B,MAAM,CAACI,KAAP,CAAahC;AADiB,SAAtC;AAGD;;AACDrB,MAAAA,WAAW,CAACmD,KAAZ,CAAkBF,MAAM,CAACE,KAAzB;AACA,WAAKxD,KAAL,CAAWwF,QAAX,CAAoBnF,WAApB;AACA,WAAKE,MAAL,CAAYgF,IAAZ,CAAiBlF,WAAjB;AACA,WAAKA,WAAL,GAAmBA,WAAnB;AACA,aAAOA,WAAP;AACD;;;6BAEkBiG,S,EAAuC;AAAA,UAAvB5E,IAAuB,uEAAR,MAAQ;AAAA,2BACrB,KAAKpB,OADgB;AAAA,UAChDqC,KADgD,kBAChDA,KADgD;AAAA,UACzCJ,MADyC,kBACzCA,MADyC;AAAA,UACjCC,OADiC,kBACjCA,OADiC;AAExD,UAAMpC,UAAU,GAAG,IAAIoG,aAAJ,CAAe;AAChCjE,QAAAA,MAAM,EAAEA,MAAM,GAAG,CADe;AAEhCC,QAAAA,OAAO,EAAPA;AAFgC,OAAf,EAIhB2C,MAJgB,CAITmB,SAJS,EAIE;AACjBG,QAAAA,MAAM,EAAE;AACN/E,UAAAA,IAAI,EAAJA,IADM;AAENgF,UAAAA,WAAW,EAAE;AAFP;AADS,OAJF,EAUhBnD,KAVgB,CAUVZ,KAAK,CAACG,KAVI,EAUqB,MAVrB,EAWhBU,KAXgB,CAWVb,KAXU,CAAnB;AAYA,WAAKyC,iBAAL,CAAuBhF,UAAvB,EAAmC,OAAnC,EAA4CuC,KAAK,CAACE,KAAlD;AACA,WAAKuC,iBAAL,CAAuBhF,UAAvB,EAAmC,MAAnC,EAA2CuC,KAAK,CAACI,IAAjD;AACA,WAAKqC,iBAAL,CAAuBhF,UAAvB,EAAmC,QAAnC,EAA6CuC,KAAK,CAAC0C,MAAnD;AACA,aAAOjF,UAAP;AACD;;;+BAEoB;AAAA;;AAAA,UACXK,KADW,GACD,KAAKH,OADJ,CACXG,KADW;AAEnB,UAAIkG,UAAJ;;AACA,UAAIlG,KAAK,CAACmG,YAAV,EAAwB;AACtBD,QAAAA,UAAU,GACRlG,KAAK,CAACmG,YAAN,KAAuB,QAAvB,GAAkC,KAAKvG,WAAvC,GAAqD,KAAKH,SAD5D;AAED,OAHD,MAGO;AACLyG,QAAAA,UAAU,GAAG,KAAKrG,OAAL,CAAagD,MAAb,CAAoBV,MAApB,GACT,KAAKvC,WADI,GAET,KAAKH,SAFT;AAGD;;AACDyG,MAAAA,UAAU,CAACE,EAAX,CAAcpG,KAAK,CAACmE,gBAApB,EAAgD,UAACkC,CAAD,EAAO;AACrD,YAAMC,IAAI,GAAGtG,KAAK,CAACqE,IAAN,GACTrE,KAAK,CAACqE,IAAN,CAAWgC,CAAC,CAAClB,OAAF,CAAUb,UAAV,GAAuB+B,CAAC,CAAClB,OAAF,CAAUb,UAAjC,GAA8C+B,CAAC,CAAClB,OAA3D,CADS,GAET,EAFJ;AAGA,QAAA,MAAI,CAACnF,KAAL,GAAa,IAAIuG,QAAJ;AACXC,UAAAA,WAAW,EAAE;AADF,WAERxG,KAAK,CAACR,MAFE,GAIViH,SAJU,CAIAJ,CAAC,CAACK,MAJF,EAKVC,OALU,CAKFL,IALE,CAAb;;AAMA,QAAA,MAAI,CAAC/G,KAAL,CAAWiG,QAAX,CAAoB,MAAI,CAACxF,KAAzB;AACD,OAXD;AAaAkG,MAAAA,UAAU,CAACE,EAAX,CAAcpG,KAAK,CAACoE,iBAApB,EAAiD,UAACiC,CAAD,EAAO;AACtD,YAAI,MAAI,CAACrG,KAAT,EAAgB;AACd,UAAA,MAAI,CAACA,KAAL,CAAW4G,MAAX;AACD;AACF,OAJD;AAKD;;;sCAGCxG,K,EACAa,I,EACA4F,I,EACA;AACA,UAAI,CAACA,IAAL,EAAW;AACT;AACD;;AACD,UAAI,uBAASA,IAAT,CAAJ,EAAoB;AAElBzG,QAAAA,KAAK,CAACa,IAAD,CAAL,CAAY4F,IAAI,CAACxE,KAAjB,EAAwBwE,IAAI,CAACC,MAA7B;AACD,OAHD,MAGO;AAEL1G,QAAAA,KAAK,CAACa,IAAD,CAAL,CAAY4F,IAAZ;AACD;AACF;;;EAzUoCE,0B","sourcesContent":["import {\n  ILayer,\n  IPopup,\n  LineLayer,\n  PointLayer,\n  PolygonLayer,\n  Popup,\n  Scene,\n  StyleAttrField,\n} from '@antv/l7';\nimport { EventEmitter } from 'eventemitter3';\n// @ts-ignore\nimport geobuf from 'geobuf';\n// tslint:disable-next-line: no-submodule-imports\nimport isObject from 'lodash/isObject';\n// tslint:disable-next-line: no-submodule-imports\nimport mergeWith from 'lodash/mergeWith';\n// @ts-ignore\nimport Pbf from 'pbf';\n// @ts-ignore\nimport simplify from 'simplify-geojson';\nimport { setDataLevel } from '../config';\nimport { AttributeType, IDistrictLayerOption } from './interface';\n\nfunction mergeCustomizer(objValue: any, srcValue: any) {\n  if (Array.isArray(srcValue)) {\n    return srcValue;\n  }\n}\nexport default class BaseLayer extends EventEmitter {\n  public fillLayer: ILayer;\n  public lineLayer: ILayer;\n  public labelLayer: ILayer;\n  public bubbleLayer: ILayer;\n  protected scene: Scene;\n  protected options: IDistrictLayerOption;\n  protected layers: ILayer[] = [];\n  protected fillData: any;\n  private popup: IPopup;\n\n  constructor(scene: Scene, option: Partial<IDistrictLayerOption> = {}) {\n    super();\n    this.scene = scene;\n    this.options = mergeWith(this.getDefaultOption(), option, mergeCustomizer);\n    setDataLevel(this.options.geoDataLevel);\n  }\n\n  public destroy() {\n    this.layers.forEach((layer) => this.scene.removeLayer(layer));\n    this.layers.length = 0;\n  }\n\n  public show() {\n    this.layers.forEach((layer) => layer.show());\n  }\n  public hide() {\n    this.layers.forEach((layer) => layer.hide());\n  }\n\n  public setOption(newOption: { [key: string]: any }) {\n    this.options = mergeWith(this.options, newOption, mergeCustomizer);\n  }\n\n  public getFillData() {\n    return this.fillData;\n  }\n\n  public updateData(\n    newData?: Array<{ [key: string]: any }>,\n    joinByField?: [string, string],\n  ) {\n    this.setOption({\n      data: newData,\n      joinBy: joinByField,\n    });\n    const { data = [], joinBy } = this.options;\n    this.fillLayer.setData(this.fillData, {\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n  }\n  protected async fetchData(data: { url: any; type: string }) {\n    if (data.type === 'pbf') {\n      const buffer = await (await fetch(data.url)).arrayBuffer();\n      let geojson = geobuf.decode(new Pbf(buffer));\n      if (this.options.simplifyTolerance !== false) {\n        geojson = simplify(geojson, this.options.simplifyTolerance);\n      }\n      return geojson;\n    } else {\n      return isObject(data.url) ? data.url : (await fetch(data.url)).json();\n    }\n  }\n  protected getDefaultOption(): IDistrictLayerOption {\n    return {\n      zIndex: 0,\n      visible: true,\n      geoDataLevel: 2,\n      depth: 1,\n      adcode: [],\n      joinBy: ['name', 'name'],\n      simplifyTolerance: false,\n      label: {\n        enable: true,\n        color: '#000',\n        field: 'name',\n        size: 10,\n        stroke: '#fff',\n        strokeWidth: 2,\n        textAllowOverlap: true,\n        opacity: 1,\n        textOffset: [0, 0],\n        padding: [5, 5],\n      },\n      bubble: {\n        enable: false,\n        shape: 'circle',\n        color: '#1AA9FF',\n        size: 15,\n        style: {\n          opacity: 1,\n          stroke: '#fff',\n          strokeWidth: 1,\n        },\n      },\n      fill: {\n        scale: null,\n        color: '#ddd',\n        style: {\n          opacity: 1.0,\n        },\n        activeColor: false,\n      },\n      autoFit: true,\n      showBorder: true,\n      stroke: '#bdbdbd',\n      strokeVisible: true,\n      strokeWidth: 0.6,\n      cityStroke: '#636363',\n      cityStrokeWidth: 0.6,\n      countyStrokeWidth: 0.6,\n      provinceStrokeWidth: 0.6,\n      provinceStroke: '#f0f0f0',\n      provinceStrokeVisible: true,\n      countyStroke: '#525252',\n      coastlineStroke: '#4190da',\n      coastlineWidth: 0.6,\n      nationalStroke: '#c994c7',\n      nationalWidth: 0.5,\n      chinaNationalStroke: 'gray',\n      chinaNationalWidth: 1,\n      popup: {\n        enable: true,\n        openTriggerEvent: 'mousemove',\n        closeTriggerEvent: 'mouseout',\n        option: {},\n        Html: (properties: any) => {\n          return `${properties.name}`;\n        },\n      },\n    };\n  }\n\n  protected addFillLayer(fillCountry: any) {\n    // 添加省份填充\n    const { popup, data = [], fill, autoFit, joinBy, visible } = this.options;\n    this.fillData = fillCountry;\n    const fillLayer = new PolygonLayer({\n      autoFit,\n      visible,\n    }).source(fillCountry, {\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n    this.setLayerAttribute(fillLayer, 'color', fill.color as AttributeType);\n    this.setLayerAttribute(fillLayer, 'filter', fill.filter as AttributeType);\n    if (fill.scale && isObject(fill.color)) {\n      fillLayer.scale('color', {\n        type: fill.scale,\n        field: fill.color.field as string,\n      });\n    }\n    fillLayer.shape('fill').style(fill.style);\n\n    if (fill.activeColor) {\n      fillLayer.active({\n        color: fill.activeColor as string,\n      });\n    }\n    this.fillLayer = fillLayer;\n    this.layers.push(fillLayer);\n    this.scene.addLayer(fillLayer);\n    if (this.options.bubble && this.options.bubble?.enable !== false) {\n      const labeldata = fillCountry.features.map((feature: any) => {\n        return {\n          ...feature.properties,\n          center: [feature.properties.x, feature.properties.y],\n        };\n      });\n      this.addBubbleLayer(labeldata);\n    }\n    if (popup.enable) {\n      this.addPopup();\n    }\n\n    this.emit('loaded');\n  }\n\n  protected addFillLine(provinceLine: any) {\n    const { stroke, strokeWidth, zIndex, visible } = this.options;\n    const layer2 = new LineLayer({\n      zIndex: zIndex + 0.1,\n      visible,\n    })\n      .source(provinceLine)\n      .color(stroke)\n      .size(strokeWidth)\n      .style({\n        opacity: 1,\n      });\n    this.scene.addLayer(layer2);\n    this.layers.push(layer2);\n    this.lineLayer = layer2;\n  }\n\n  protected addLabelLayer(labelData: any, type: string = 'json') {\n    const labelLayer = this.addLabel(labelData, type);\n    this.scene.addLayer(labelLayer);\n    this.layers.push(labelLayer);\n    this.labelLayer = labelLayer;\n  }\n\n  protected addBubbleLayer(labelData: any, type: string = 'json') {\n    const { bubble, zIndex, data = [], joinBy, visible } = this.options;\n    const bubbleLayer = new PointLayer({\n      zIndex: zIndex + 0.3,\n      visible,\n    }).source(labelData, {\n      parser: {\n        type,\n        coordinates: 'center',\n      },\n      transforms:\n        data.length === 0\n          ? []\n          : [\n              {\n                type: 'join',\n                sourceField: joinBy[1], // data1 对应字段名\n                targetField: joinBy[0], // data 对应字段名 绑定到的地理数据\n                data,\n              },\n            ],\n    });\n    this.setLayerAttribute(bubbleLayer, 'color', bubble.color as AttributeType);\n    this.setLayerAttribute(bubbleLayer, 'size', bubble.size as AttributeType);\n    this.setLayerAttribute(bubbleLayer, 'shape', bubble.shape as AttributeType);\n    this.setLayerAttribute(\n      bubbleLayer,\n      'filter',\n      bubble.filter as AttributeType,\n    );\n    if (bubble.scale) {\n      bubbleLayer.scale(bubble.scale.field, {\n        type: bubble.scale.type,\n      });\n    }\n    bubbleLayer.style(bubble.style);\n    this.scene.addLayer(bubbleLayer);\n    this.layers.push(bubbleLayer);\n    this.bubbleLayer = bubbleLayer;\n    return bubbleLayer;\n  }\n\n  protected addLabel(labelData: any, type: string = 'json') {\n    const { label, zIndex, visible } = this.options;\n    const labelLayer = new PointLayer({\n      zIndex: zIndex + 5,\n      visible,\n    })\n      .source(labelData, {\n        parser: {\n          type,\n          coordinates: 'center',\n        },\n      })\n      .shape(label.field as StyleAttrField, 'text')\n      .style(label);\n    this.setLayerAttribute(labelLayer, 'color', label.color as AttributeType);\n    this.setLayerAttribute(labelLayer, 'size', label.size as AttributeType);\n    this.setLayerAttribute(labelLayer, 'filter', label.filter);\n    return labelLayer;\n  }\n\n  protected addPopup() {\n    const { popup } = this.options;\n    let popupLayer;\n    if (popup.triggerLayer) {\n      popupLayer =\n        popup.triggerLayer === 'bubble' ? this.bubbleLayer : this.fillLayer;\n    } else {\n      popupLayer = this.options.bubble.enable\n        ? this.bubbleLayer\n        : this.fillLayer;\n    }\n    popupLayer.on(popup.openTriggerEvent as string, (e) => {\n      const html = popup.Html\n        ? popup.Html(e.feature.properties ? e.feature.properties : e.feature)\n        : '';\n      this.popup = new Popup({\n        closeButton: false,\n        ...popup.option,\n      })\n        .setLnglat(e.lngLat)\n        .setHTML(html);\n      this.scene.addPopup(this.popup);\n    });\n\n    popupLayer.on(popup.closeTriggerEvent as string, (e) => {\n      if (this.popup) {\n        this.popup.remove();\n      }\n    });\n  }\n\n  private setLayerAttribute(\n    layer: ILayer,\n    type: 'color' | 'size' | 'shape' | 'filter',\n    attr: AttributeType | undefined,\n  ) {\n    if (!attr) {\n      return;\n    }\n    if (isObject(attr)) {\n      // @ts-ignore\n      layer[type](attr.field, attr.values);\n    } else {\n      // @ts-ignore\n      layer[type](attr);\n    }\n  }\n}\n"],"file":"baseLayer.js"}